<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sci-Fi Frame Engine V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');

        /* Base Dark Theme & Font */
        body {
            background-color: #050505;
            color: #e4e4e7;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Animation Keyframes */
        @keyframes draw-path {
            from { stroke-dasharray: 0, 5000; }
            to { stroke-dasharray: 5000, 0; }
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.3; }
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        /* Utilities */
        .animate-draw path {
            animation: draw-path 2s ease-out forwards;
        }

        .scanline::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to bottom, transparent, rgba(6, 182, 212, 0.1), transparent);
            animation: scanline 4s linear infinite;
            pointer-events: none;
        }

        /* Scrollbar hiding for cleaner UI */
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden bg-black flex">

    <!-- SIDEBAR CONTROLS -->
    <div class="w-64 border-r border-white/10 flex flex-col bg-zinc-950 z-20">
        <div class="p-6 border-b border-white/10">
            <h1 class="text-xl font-bold text-white tracking-tighter">FRAME<span class="text-cyan-500">_OS</span></h1>
            <p class="text-xs text-zinc-500 mt-1">v2.0.4 // RENDER_FIXED</p>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-2">
            <p class="text-[10px] uppercase text-zinc-600 font-bold tracking-widest mb-2">Select Module</p>
            
            <button onclick="switchMode('cyberpunk')" class="mode-btn w-full text-left px-4 py-3 rounded border border-transparent hover:border-cyan-900 hover:bg-cyan-950/30 text-sm transition-all group active-mode" data-mode="cyberpunk">
                <span class="text-cyan-500 group-hover:text-cyan-400 font-bold">01.</span> Colors
            </button>
            <button onclick="switchMode('hud')" class="mode-btn w-full text-left px-4 py-3 rounded border border-transparent hover:border-emerald-900 hover:bg-emerald-950/30 text-sm transition-all group" data-mode="hud">
                <span class="text-emerald-500 group-hover:text-emerald-400 font-bold">02.</span> Structure
            </button>
            <button onclick="switchMode('industrial')" class="mode-btn w-full text-left px-4 py-3 rounded border border-transparent hover:border-amber-900 hover:bg-amber-950/30 text-sm transition-all group" data-mode="industrial">
                <span class="text-amber-500 group-hover:text-amber-400 font-bold">03.</span> Design
            </button>
            <button onclick="switchMode('terminal')" class="mode-btn w-full text-left px-4 py-3 rounded border border-transparent hover:border-zinc-700 hover:bg-zinc-900 text-sm transition-all group" data-mode="terminal">
                <span class="text-zinc-400 group-hover:text-white font-bold">04.</span> Typography
            </button>
            <button onclick="switchMode('breach')" class="mode-btn w-full text-left px-4 py-3 rounded border border-transparent hover:border-red-900 hover:bg-red-950/30 text-sm transition-all group" data-mode="breach">
                <span class="text-red-500 group-hover:text-red-400 font-bold">05.</span> Animation
            </button>
        </div>

        <div class="p-4 border-t border-white/10 text-[10px] text-zinc-600">
            COORD_SYSTEM: RELATIVE<br>
            ANTIALIAS: ENABLED
        </div>
    </div>

    <!-- MAIN VIEWPORT -->
    <main class="flex-1 relative flex items-center justify-center bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-zinc-900 via-black to-black">
        
        <!-- Grid Background -->
        <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none"></div>
        <div class="absolute inset-0 opacity-10" style="background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 40px 40px;"></div>

        <!-- THE FRAME CONTAINER -->
        <!-- 
            Note on Architecture:
            The classes on this wrapper drive the CSS Variables that the SVG uses.
            Changing these classes instantly re-themes the entire SVG.
        -->
        <div id="frame-wrapper" class="relative w-[800px] h-[500px] transition-all duration-500">
            
            <!-- SVG LAYER -->
            <div id="svg-layer" class="absolute inset-0 pointer-events-none transition-all duration-500">
                <svg id="sci-fi-frame" class="w-full h-full"></svg>
            </div>

            <!-- CONTENT LAYER -->
            <div id="content-layer" class="relative z-10 w-full h-full p-12 flex flex-col transition-all duration-500">
                <!-- Content injected by JS -->
            </div>

        </div>

    </main>

    <!-- ENGINE SCRIPT -->
    <script>
        // --- 1. DATA REPOSITORY (The "Database") ---
        
        // Original Complex Path Data (Refined)
        const PATHS_COMPLEX = [
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"var(--color-frame-1-fill)"},"path":[["M","37","12"],["L","0% + 59","12"],["L","0% + 85","0% + 33"],["L","79","0% + 12"],["L","50% - 3","12"],["L","50% + 16","30"],["L","100% - 35","30"],["L","100% - 16","47"],["L","100% - 16","100% - 47.05882352941177%"],["L","100% - 8","100% - 44.85294117647059%"],["L","100% - 9","100% - 16.666666666666668%"],["L","100% - 17","100% - 14.705882352941176%"],["L","100% - 17","100% - 30"],["L","100% - 34","100% - 12"],["L","50% + 13","100% - 12"],["L","50% + 15","100% - 26"],["L","50% - 11","100% - 12"],["L","37","100% - 12"],["L","19","100% - 30"],["L","19","0% + 50.490196078431374%"],["L","10","0% + 48.529411764705884%"],["L","10","0% + 20.098039215686274%"],["L","0% + 19.000000000000004","0% + 18.38235294117647%"],["L","19","29"],["L","37","12"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-2-stroke)","fill":"var(--color-frame-2-fill)"},"path":[["M","50% + 10","15"],["L","50% + 19","15"],["L","50% + 24","0% + 20"],["L","50% + 16","0% + 20"],["L","50% + 10","15"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-3-stroke)","fill":"var(--color-frame-3-fill)"},"path":[["M","50% + 25","15"],["L","50% + 34","15"],["L","50% + 40","0% + 21"],["L","50% + 31","0% + 21"],["L","50% + 25","15"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-4-stroke)","fill":"var(--color-frame-4-fill)"},"path":[["M","50% + 40","15"],["L","50% + 52","15"],["L","50% + 61","0% + 23"],["L","50% + 49","0% + 23"],["L","50% + 40","15"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-5-stroke)","fill":"var(--color-frame-5-fill)"},"path":[["M","36","3"],["L","0% + 58","0"],["L","0% + 84","0% + 40"],["L","81","0% + 0"],["L","50% - 1","4"],["L","50% + 5","6"],["L","50% + 54","7"],["L","50% + 74","23"],["L","100% - 32","21"],["L","100% - 8","42"],["L","100% - 9","100% - 52.450980392156865%"],["L","100% + 0","100% - 50.245098039215684%"],["L","100% + 0","100% - 15.196078431372548%"],["L","100% - 7","100% - 13.480392156862745%"],["L","100% - 7","100% - 27"],["L","100% - 29","100% - 3"],["L","50% + 14","100% + 0"],["L","50% + 21","100% - 31"],["L","50% - 13","100% + 0"],["L","37","100% - 4"],["L","11","100% - 28"],["L","10","0% + 55.3921568627451%"],["L","0","0% + 52.94117647058823%"],["L","1","0% + 18.627450980392158%"],["L","11","0% + 16.666666666666668%"],["L","11","25"],["L","36","3"]]}
        ];

        // Simple Chamfered Box
        const PATHS_INDUSTRIAL = [
            {"show":true,"style":{"strokeWidth":"2","stroke":"var(--color-frame-1-stroke)","fill":"var(--color-frame-1-fill)"},"path":[["M","20","0"],["L","100% - 20","0"],["L","100%","20"],["L","100%","100% - 20"],["L","100% - 20","100%"],["L","20","100%"],["L","0","100% - 20"],["L","0","20"],["L","20","0"]]},
            {"show":true,"style":{"strokeWidth":"2","stroke":"var(--color-frame-2-stroke)","fill":"transparent"},"path":[["M","0","100% - 60"],["L","0","100% - 25"],["L","25","100%"],["L","60","100%"]]},
            {"show":true,"style":{"strokeWidth":"2","stroke":"var(--color-frame-2-stroke)","fill":"transparent"},"path":[["M","100%","60"],["L","100%","25"],["L","100% - 25","0"],["L","100% - 60","0"]]}
        ];

        // HUD / Header Style
        const PATHS_HUD = [
            // Header Bar
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"var(--color-frame-1-fill)"},"path":[["M","0","0"],["L","200","0"],["L","220","20"],["L","100%","20"],["L","100%","100%"],["L","0","100%"],["L","0","0"]]},
            // Decoration
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-2-stroke)","fill":"var(--color-frame-2-fill)"},"path":[["M","10","30"],["L","10","100% - 10"],["L","30","100% - 10"]]}
        ];

        // Terminal / Bracket Style
        const PATHS_TERMINAL = [
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"none"},"path":[["M","0","30"],["L","0","0"],["L","30","0"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"none"},"path":[["M","100% - 30","0"],["L","100%","0"],["L","100%","30"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"none"},"path":[["M","100%","100% - 30"],["L","100%","100%"],["L","100% - 30","100%"]]},
            {"show":true,"style":{"strokeWidth":"1","stroke":"var(--color-frame-1-stroke)","fill":"none"},"path":[["M","30","100%"],["L","0","100%"],["L","0","100% - 30"]]}
        ];


        // --- 2. CONFIGURATIONS ---
        const CONFIGS = {
            'cyberpunk': {
                paths: PATHS_COMPLEX,
                wrapperClass: `
                    text-cyan-500
                    [--color-primary:currentColor] 
                    [--color-accent:theme(colors.purple.500)]
                    [--color-frame-1-stroke:var(--color-primary)]
                    [--color-frame-1-fill:rgba(6,182,212,0.1)]
                    [--color-frame-2-stroke:var(--color-accent)]
                    [--color-frame-2-fill:rgba(168,85,247,0.1)]
                    [--color-frame-3-stroke:var(--color-accent)]
                    [--color-frame-3-fill:rgba(168,85,247,0.1)]
                    [--color-frame-4-stroke:var(--color-accent)]
                    [--color-frame-4-fill:rgba(168,85,247,0.1)]
                    [--color-frame-5-stroke:var(--color-primary)]
                    [--color-frame-5-fill:transparent]
                    drop-shadow-[0_0_10px_rgba(6,182,212,0.3)]
                `,
                content: `
                    <div class="h-full flex flex-col items-center justify-center text-center">
                        <div class="text-xs font-bold text-cyan-800 mb-2 tracking-[0.2em]">SYSTEM_ID: NEON_FLUX</div>
                        <h1 class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-br from-cyan-400 to-purple-600 uppercase tracking-tighter">Cyberpunk</h1>
                        <div class="mt-8 grid grid-cols-3 gap-2 w-48">
                            <div class="h-1 bg-cyan-500/50"></div>
                            <div class="h-1 bg-cyan-500/30"></div>
                            <div class="h-1 bg-cyan-500/10"></div>
                        </div>
                    </div>
                `
            },
            'hud': {
                paths: PATHS_HUD,
                wrapperClass: `
                    text-emerald-500
                    [--color-frame-1-stroke:theme(colors.emerald.500)]
                    [--color-frame-1-fill:rgba(16,185,129,0.05)]
                    [--color-frame-2-stroke:theme(colors.emerald.300)]
                    [--color-frame-2-fill:transparent]
                    drop-shadow-[0_0_5px_rgba(16,185,129,0.2)]
                `,
                content: `
                    <div class="h-full flex flex-col text-emerald-100">
                        <div class="absolute top-1 left-2 text-[10px] font-bold text-emerald-950">SECURE_DATA_STRUCTURE</div>
                        <div class="mt-8 flex-1 border border-emerald-900/30 p-4 bg-emerald-950/20 rounded">
                            <h3 class="text-sm font-bold border-b border-emerald-800 pb-2 mb-2">DIAGNOSTICS</h3>
                            <div class="space-y-2 font-mono text-xs opacity-70">
                                <div class="flex justify-between"><span>CORE_TEMP</span><span>45Â°C</span></div>
                                <div class="flex justify-between"><span>MEMORY</span><span>128TB</span></div>
                                <div class="flex justify-between"><span>UPTIME</span><span>99.9%</span></div>
                            </div>
                        </div>
                    </div>
                `
            },
            'industrial': {
                paths: PATHS_INDUSTRIAL,
                wrapperClass: `
                    text-amber-500
                    [--color-frame-1-stroke:theme(colors.amber.600)]
                    [--color-frame-1-fill:rgba(217,119,6,0.05)]
                    [--color-frame-2-stroke:theme(colors.yellow.400)]
                    [--color-frame-2-fill:transparent]
                `,
                content: `
                    <div class="h-full flex items-center justify-center bg-[repeating-linear-gradient(45deg,transparent,transparent_10px,rgba(245,158,11,0.05)_10px,rgba(245,158,11,0.05)_20px)]">
                        <div class="border-2 border-amber-500 px-8 py-4 bg-black">
                            <h2 class="text-4xl font-bold text-amber-500 tracking-tighter">HEAVY DUTY</h2>
                            <div class="flex items-center gap-2 mt-2">
                                <div class="w-3 h-3 bg-amber-500 animate-pulse"></div>
                                <span class="text-xs text-amber-700 font-bold">CAUTION: HIGH VOLTAGE</span>
                            </div>
                        </div>
                    </div>
                `
            },
            'terminal': {
                paths: PATHS_TERMINAL,
                wrapperClass: `
                    text-zinc-400
                    [--color-frame-1-stroke:theme(colors.zinc.600)]
                `,
                content: `
                    <div class="h-full flex flex-col justify-end pb-8 pl-8">
                        <div class="font-mono text-sm space-y-1">
                            <p class="text-zinc-500">> initiating handshake...</p>
                            <p class="text-zinc-500">> connected to localhost:3000</p>
                            <p class="text-white">> _<span class="animate-pulse">|</span></p>
                        </div>
                    </div>
                `
            },
            'breach': {
                paths: PATHS_COMPLEX,
                wrapperClass: `
                    text-red-500 animate-draw
                    [--color-frame-1-stroke:theme(colors.red.600)]
                    [--color-frame-1-fill:rgba(220,38,38,0.1)]
                    [--color-frame-2-stroke:theme(colors.red.400)]
                    [--color-frame-2-fill:transparent]
                    [--color-frame-3-stroke:theme(colors.orange.500)]
                    [--color-frame-3-fill:transparent]
                    [--color-frame-4-stroke:transparent]
                    [--color-frame-4-fill:transparent]
                    [--color-frame-5-stroke:theme(colors.red.600)]
                    [--color-frame-5-fill:transparent]
                    drop-shadow-[0_0_25px_rgba(220,38,38,0.5)]
                `,
                content: `
                    <div class="h-full flex items-center justify-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-red-950/20 animate-[pulse-red_1s_ease-in-out_infinite]"></div>
                        <h1 class="text-6xl font-black text-red-500 z-10 glitch-text tracking-tighter">BREACH</h1>
                        <div class="scanline absolute inset-0 pointer-events-none"></div>
                    </div>
                `
            }
        };


        // --- 3. ROBUST ENGINE ---
        class SvgFrameRenderer {
            constructor(svgElementId) {
                this.svg = document.getElementById(svgElementId);
                this.data = [];
                this.ro = null;
                this.init();
            }

            init() {
                if (!this.svg) return;
                
                // Force precision styles for sharper angles
                this.svg.style.shapeRendering = "geometricPrecision";
                
                this.render();

                this.ro = new ResizeObserver(() => {
                    requestAnimationFrame(() => this.render());
                });
                this.ro.observe(this.svg);
            }

            setData(newData) {
                this.data = newData;
                this.render();
            }

            /**
             * Improved Coordinate Parser
             * Handles: "100% - 20", "50% + 10.5", "0% + 5"
             * Now more robust against spacing issues.
             */
            parseCoordinate(val, maxDimension) {
                if (typeof val === 'number') return val;
                
                // Remove all spaces to handle " 100% - 16 " -> "100%-16"
                // Then replace + and - with " + " and " - " to normalize split
                const normalized = val.toString().replace(/\s/g, '').replace(/\+/g, ' + ').replace(/-/g, ' - ');
                const parts = normalized.split(' ').filter(p => p !== '');
                
                let result = 0;
                let currentOp = 1; // 1 for +, -1 for -

                for (let part of parts) {
                    if (part === '+') { currentOp = 1; continue; }
                    if (part === '-') { currentOp = -1; continue; }

                    let numVal = 0;
                    if (part.includes('%')) {
                        const pct = parseFloat(part.replace('%', ''));
                        numVal = (pct / 100) * maxDimension;
                    } else {
                        numVal = parseFloat(part);
                    }
                    
                    result += (numVal * currentOp);
                }

                return result;
            }

            render() {
                if(!this.svg) return;
                const rect = this.svg.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                
                // Use a fragment to minimize reflows
                const fragment = document.createDocumentFragment();

                this.data.forEach(layer => {
                    if (!layer.show) return;

                    const pathEl = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    
                    // Default styles for better angles
                    pathEl.style.strokeLinecap = "round";  // Fixes sharp spikes
                    pathEl.style.strokeLinejoin = "round"; // Fixes sharp spikes
                    pathEl.style.vectorEffect = "non-scaling-stroke"; // Ensures crisp lines if scaled
                    
                    for (const [key, value] of Object.entries(layer.style)) {
                        pathEl.style[key] = value;
                    }
                    
                    let d = '';
                    
                    if (layer.path && Array.isArray(layer.path)) {
                        layer.path.forEach(cmd => {
                            const type = cmd[0];
                            // Only M and L commands use 2 coordinates. Z uses 0.
                            if (type === 'Z' || type === 'z') {
                                d += `Z `;
                            } else {
                                const x = this.parseCoordinate(cmd[1], width);
                                const y = this.parseCoordinate(cmd[2], height);
                                d += `${type} ${x.toFixed(2)} ${y.toFixed(2)} `; // toFixed helps debug and clean SVG
                            }
                        });
                    }

                    pathEl.setAttribute('d', d.trim());
                    fragment.appendChild(pathEl);
                });

                this.svg.innerHTML = '';
                this.svg.appendChild(fragment);
            }
        }

        // --- 4. APP LOGIC ---
        const renderer = new SvgFrameRenderer('sci-fi-frame');
        const wrapper = document.getElementById('frame-wrapper');
        const contentLayer = document.getElementById('content-layer');
        const svgLayer = document.getElementById('svg-layer');

        function switchMode(modeKey) {
            const config = CONFIGS[modeKey];
            if (!config) return;

            // 1. Update UI State
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('bg-zinc-800', 'border-zinc-600');
                if(btn.dataset.mode === modeKey) {
                    // Highlight active logic is handled by specific hover colors in HTML, 
                    // but we can add a subtle bg indicator here if needed.
                }
            });

            // 2. Animate Out
            wrapper.style.opacity = '0';
            wrapper.style.transform = 'scale(0.98)';

            setTimeout(() => {
                // 3. Apply New Data
                // Reset wrapper classes completely to base + new
                wrapper.className = `relative transition-all duration-500 ${config.wrapperClass}`;
                
                // Adjust size based on mode? 
                // The user asked for "different frame size".
                // We'll simulate this by changing the container width/height styles for specific modes
                if (modeKey === 'terminal') {
                    wrapper.style.width = '600px';
                    wrapper.style.height = '300px';
                } else if (modeKey === 'hud') {
                     wrapper.style.width = '500px';
                     wrapper.style.height = '600px';
                } else {
                    wrapper.style.width = '800px';
                    wrapper.style.height = '500px';
                }

                contentLayer.innerHTML = config.content;
                renderer.setData(config.paths);

                // 4. Animate In
                wrapper.style.opacity = '1';
                wrapper.style.transform = 'scale(1)';
            }, 300);
        }

        // Init
        switchMode('cyberpunk');

    </script>
</body>
</html>